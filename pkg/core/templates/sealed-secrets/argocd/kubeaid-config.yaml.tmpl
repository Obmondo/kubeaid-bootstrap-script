{{- $name := "kubeaid-config" }}
{{- if .CustomerID }}
{{- $name = printf "kubeaid-config-%s" .CustomerID }}
{{- end }}

apiVersion: v1
kind: Secret
metadata:
  name: {{ $name }}
  namespace: argocd
  labels:
    argocd.argoproj.io/secret-type: repository

stringData:
  name: {{ $name }}
  url: {{ .KubeaidConfigForkURL }}
  type: git
  {{- if .GitCredentials.SSHPrivateKey }}
  sshPrivateKey: |
    {{- $sshKey := .GitCredentials.SSHPrivateKey }}
    {{- $lines := split $sshKey "\n" }}
    {{- range $index, $line := $lines }}
        {{ $line }}
    {{- end }}
  {{- else }}
  username: {{ .GitCredentials.Username }}
  password: {{ .GitCredentials.Password }}
  {{- end }}
